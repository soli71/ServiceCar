@page "/service-car"
@using Microsoft.EntityFrameworkCore
@using OilChangeApp.Data
@inject OilChangeDbContext DbContext

<h3>Service Entry</h3>

<EditForm Model="customerService" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label>Customer:</label>
        <select @bind="customerService.CustomerId">
            @foreach (var customer in customers)
            {
                @* <option value="@customer.Id">@customer.Name - @customer.CarModel</option> *@
            }
        </select>
    </div>
    <div>
        <label>Service:</label>
        <select @bind="customerService.ServiceId">
            @foreach (var service in services)
            {
                <option value="@service.Id">@service.ServiceName</option>
            }
        </select>
    </div>
    <div>
        <label>Service Date:</label>
        <InputDate @bind-Value="customerService.ServiceDate" />
    </div>
    <button type="submit">Save Service</button>
</EditForm>

@code {
    private CustomerService customerService = new CustomerService();
    private List<Customer> customers = new List<Customer>();
    private List<Service> services = new List<Service>();

    protected override async Task OnInitializedAsync()
    {
        customers = await DbContext.Customers.ToListAsync();
        services = await DbContext.Services.ToListAsync();
    }

    private async Task HandleValidSubmit()
    {
        DbContext.CustomerServices.Add(customerService);
        await DbContext.SaveChangesAsync();
        customerService = new CustomerService(); 
    }
}
